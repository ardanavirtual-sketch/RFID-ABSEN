<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Sistem Absensi Modern</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --wp-primary: #0073aa;
            --wp-primary-dark: #005a87;
            --wp-secondary: #23282d;
            --wp-secondary-light: #32373c;
            --wp-accent: #00a0d2;
            --wp-success: #46b450;
            --wp-warning: #ffb900;
            --wp-error: #dc3232;
            --wp-text: #23282d;
            --wp-text-light: #72777c;
            --wp-border: #ccd0d4;
            --wp-bg: #f1f1f1;
            --wp-card: #ffffff;
            
            --dark-bg: #1a1d21;
            --dark-card: #2c3138;
            --dark-text: #e4e6eb;
            --dark-border: #3e444c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e6eb 100%);
            color: var(--wp-text);
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, var(--dark-bg) 0%, #23272f 100%);
            color: var(--dark-text);
        }

        /* Glassmorphism Effect */
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .dark-mode .glass-card {
            background: rgba(44, 49, 56, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Sidebar */
        #sidebar {
            background: linear-gradient(180deg, var(--wp-secondary) 0%, #1a1d21 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
        }

        #sidebar.collapsed {
            width: 70px;
        }

        #sidebar.collapsed .sidebar-text {
            display: none;
        }

        #sidebar.collapsed .logo-text {
            display: none;
        }

        #sidebar.collapsed .user-info {
            display: none;
        }

        #sidebar.collapsed .toggle-btn {
            transform: rotate(180deg);
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--wp-primary);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--wp-primary-dark);
        }

        /* Stats Cards */
        .stat-card {
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--wp-primary), var(--wp-accent));
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .dark-mode .stat-card:hover {
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        /* Button Styles */
        .btn-primary {
            background: linear-gradient(135deg, var(--wp-primary), var(--wp-accent));
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--wp-primary-dark), var(--wp-primary));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 115, 170, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--wp-success), #3aa355);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--wp-error), #c92c2c);
        }

        /* Modal Styles */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            animation: modalSlideIn 0.3s ease-out;
            background: linear-gradient(135deg, var(--wp-card) 0%, #f8f9fa 100%);
        }

        .dark-mode .modal-content {
            background: linear-gradient(135deg, var(--dark-card) 0%, #252a32 100%);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Loading Animation */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 115, 170, 0.2);
            border-top-color: var(--wp-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: rgba(255, 185, 0, 0.1);
            color: var(--wp-warning);
            border: 1px solid rgba(255, 185, 0, 0.3);
        }

        .status-success {
            background: rgba(70, 180, 80, 0.1);
            color: var(--wp-success);
            border: 1px solid rgba(70, 180, 80, 0.3);
        }

        .status-error {
            background: rgba(220, 50, 50, 0.1);
            color: var(--wp-error);
            border: 1px solid rgba(220, 50, 50, 0.3);
        }

        /* Import Progress */
        .import-progress {
            height: 8px;
            border-radius: 4px;
            background: var(--wp-border);
            overflow: hidden;
        }

        .dark-mode .import-progress {
            background: var(--dark-border);
        }

        .import-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--wp-primary), var(--wp-accent));
            border-radius: 4px;
            transition: width 0.6s ease;
            width: 0%;
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--wp-border);
        }

        .dark-mode .timeline::before {
            background: var(--dark-border);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--wp-primary);
            border: 2px solid white;
        }

        .dark-mode .timeline-item::before {
            border-color: var(--dark-bg);
        }
    </style>
</head>
<body class="light-mode">
    
    <!-- Floating Action Button -->
    <div class="fab" id="fab" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </div>

    <!-- Sidebar -->
    <div id="sidebar" class="fixed left-0 top-0 h-screen w-64 z-50">
        <div class="h-full flex flex-col">
            <!-- Logo -->
            <div class="p-6 border-b border-gray-800 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-[#0073aa] to-[#00a0d2] flex items-center justify-center shadow-lg">
                        <i class="fas fa-tachometer-alt text-white text-lg"></i>
                    </div>
                    <div class="logo-text">
                        <h1 class="text-xl font-bold text-white">Admin<span class="text-[#00a0d2]">Pro</span></h1>
                        <p class="text-xs text-gray-400">Sistem Absensi</p>
                    </div>
                </div>
                <button id="sidebar-toggle" onclick="toggleSidebar()" class="toggle-btn w-8 h-8 rounded-lg bg-gray-800 hover:bg-gray-700 flex items-center justify-center text-white transition-transform">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>

            <!-- User Profile -->
            <div class="p-4 border-b border-gray-800 user-info">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-br from-[#0073aa] to-[#00a0d2] flex items-center justify-center relative">
                        <i class="fas fa-user text-white text-lg"></i>
                        <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-[#46b450] rounded-full border-2 border-gray-900"></div>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-sm font-semibold text-white" id="admin-name">Administrator</h3>
                        <p class="text-xs text-gray-400">Super Admin</p>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 p-4 space-y-2 overflow-y-auto custom-scrollbar">
                <div class="nav-item active" onclick="switchView('dashboard')">
                    <div class="flex items-center p-3 text-gray-300 hover:text-white cursor-pointer">
                        <div class="w-8 h-8 rounded-lg bg-[#0073aa]/20 flex items-center justify-center mr-3">
                            <i class="fas fa-home text-[#00a0d2]"></i>
                        </div>
                        <span class="sidebar-text text-sm font-medium">Dashboard</span>
                    </div>
                </div>

                <div class="nav-item" onclick="switchView('karyawan')">
                    <div class="flex items-center p-3 text-gray-300 hover:text-white cursor-pointer">
                        <div class="w-8 h-8 rounded-lg bg-[#0073aa]/20 flex items-center justify-center mr-3">
                            <i class="fas fa-users text-[#00a0d2]"></i>
                        </div>
                        <span class="sidebar-text text-sm font-medium">Data Karyawan</span>
                    </div>
                </div>

                <div class="nav-item" onclick="switchView('absensi')">
                    <div class="flex items-center p-3 text-gray-300 hover:text-white cursor-pointer">
                        <div class="w-8 h-8 rounded-lg bg-[#0073aa]/20 flex items-center justify-center mr-3">
                            <i class="fas fa-clipboard-list text-[#00a0d2]"></i>
                        </div>
                        <span class="sidebar-text text-sm font-medium">Log Absensi</span>
                    </div>
                </div>

                <div class="nav-item" onclick="switchView('pending-import')">
                    <div class="flex items-center p-3 text-gray-300 hover:text-white cursor-pointer">
                        <div class="w-8 h-8 rounded-lg bg-[#0073aa]/20 flex items-center justify-center mr-3">
                            <i class="fas fa-clock text-[#00a0d2]"></i>
                        </div>
                        <span class="sidebar-text text-sm font-medium">Pending Import</span>
                        <span class="ml-auto notification-badge" id="pending-count">0</span>
                    </div>
                </div>

                <div class="nav-item" onclick="switchView('laporan')">
                    <div class="flex items-center p-3 text-gray-300 hover:text-white cursor-pointer">
                        <div class="w-8 h-8 rounded-lg bg-[#0073aa]/20 flex items-center justify-center mr-3">
                            <i class="fas fa-chart-bar text-[#00a0d2]"></i>
                        </div>
                        <span class="sidebar-text text-sm font-medium">Laporan</span>
                    </div>
                </div>

                <div class="nav-item" onclick="switchView('pengaturan')">
                    <div class="flex items-center p-3 text-gray-300 hover:text-white cursor-pointer">
                        <div class="w-8 h-8 rounded-lg bg-[#0073aa]/20 flex items-center justify-center mr-3">
                            <i class="fas fa-cog text-[#00a0d2]"></i>
                        </div>
                        <span class="sidebar-text text-sm font-medium">Pengaturan</span>
                    </div>
                </div>

                <!-- Theme Toggle -->
                <div class="mt-8 p-4 border-t border-gray-800">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 rounded-lg bg-[#0073aa]/20 flex items-center justify-center">
                                <i class="fas fa-moon text-[#00a0d2]"></i>
                            </div>
                            <span class="sidebar-text text-sm text-gray-300">Dark Mode</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="theme-toggle" onchange="toggleTheme()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </nav>

            <!-- Footer -->
            <div class="p-4 border-t border-gray-800">
                <button onclick="handleLogout()" class="w-full flex items-center justify-center p-3 bg-gradient-to-r from-[#dc3232] to-[#c92c2c] text-white rounded-lg hover:from-[#c92c2c] hover:to-[#b52727] transition-all shadow-lg">
                    <i class="fas fa-sign-out-alt mr-2"></i>
                    <span class="sidebar-text text-sm font-medium">Keluar</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="content-wrapper min-h-screen transition-all duration-300">
        <!-- Top Bar -->
        <header class="glass-card sticky top-0 z-40">
            <div class="px-6 py-4">
                <div class="flex items-center justify-between">
                    <!-- Breadcrumb -->
                    <div class="breadcrumb">
                        <span class="breadcrumb-item">Admin</span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item active" id="breadcrumb-current">Dashboard</span>
                    </div>

                    <!-- Right Actions -->
                    <div class="flex items-center space-x-4">
                        <!-- Notifications -->
                        <div class="relative">
                            <button class="w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 flex items-center justify-center relative">
                                <i class="fas fa-bell text-gray-600 dark:text-gray-300"></i>
                                <span class="notification-badge" id="notification-count">0</span>
                            </button>
                        </div>

                        <!-- Mobile Menu Button -->
                        <button class="mobile-menu-btn w-10 h-10 rounded-lg bg-[#0073aa] text-white flex items-center justify-center md:hidden" onclick="toggleMobileMenu()">
                            <i class="fas fa-bars"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content Area -->
        <main class="p-6">
            <!-- Global Message -->
            <div id="global-message" class="mb-6 hidden">
                <div class="p-4 rounded-lg shadow-lg">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle mr-3 text-[#46b450]"></i>
                            <span id="message-text"></span>
                        </div>
                        <button onclick="hideMessage()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Dashboard View -->
            <div id="dashboard-view" class="space-y-6">
                <!-- Welcome Banner -->
                <div class="glass-card rounded-2xl p-6">
                    <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                        <div>
                            <h1 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-2">
                                Selamat Datang, <span id="greeting-name">Admin</span>! ðŸ‘‹
                            </h1>
                            <p class="text-gray-600 dark:text-gray-300">
                                Kelola sistem absensi karyawan dengan mudah dan efisien.
                            </p>
                        </div>
                        <div class="mt-4 md:mt-0">
                            <div class="text-sm text-gray-500 dark:text-gray-400">
                                <i class="fas fa-calendar-alt mr-2"></i>
                                <span id="current-date"></span>
                            </div>
                            <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                                <i class="fas fa-clock mr-2"></i>
                                Sinkronisasi berikutnya: <span id="next-sync-time">21:00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" id="dashboard-stats">
                    <!-- Stats will be loaded here -->
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Recent Activity -->
                    <div class="glass-card rounded-2xl p-6 lg:col-span-2">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-bold text-gray-800 dark:text-white">
                                <i class="fas fa-history mr-2 text-[#0073aa]"></i>
                                Aktivitas Terbaru
                            </h2>
                            <button class="text-sm text-[#0073aa] hover:text-[#005a87] font-medium" onclick="switchView('absensi')">
                                Lihat Semua â†’
                            </button>
                        </div>
                        <div class="space-y-4" id="recent-activity">
                            <!-- Activity items will be loaded here -->
                        </div>
                    </div>

                    <!-- Pending Import Summary -->
                    <div class="glass-card rounded-2xl p-6">
                        <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-6">
                            <i class="fas fa-clock mr-2 text-[#0073aa]"></i>
                            Pending Import
                        </h2>
                        <div class="space-y-4" id="pending-summary">
                            <div class="text-center py-8">
                                <div class="loading-spinner mx-auto"></div>
                                <p class="mt-4 text-gray-600 dark:text-gray-400">Memuat data...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Karyawan View -->
            <div id="karyawan-view" class="space-y-6 hidden">
                <!-- Header -->
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-2">
                            <i class="fas fa-users mr-3 text-[#0073aa]"></i>
                            Data Karyawan
                        </h1>
                        <p class="text-gray-600 dark:text-gray-300">
                            Kelola informasi dan data karyawan
                        </p>
                    </div>
                    <div class="flex space-x-3 mt-4 md:mt-0">
                        <button onclick="openImportModal()" class="btn-primary px-5 py-2.5 rounded-lg font-semibold flex items-center">
                            <i class="fas fa-file-import mr-2"></i>
                            Import Excel
                        </button>
                        <button onclick="openFormModal('create')" class="btn-success px-5 py-2.5 rounded-lg font-semibold flex items-center">
                            <i class="fas fa-user-plus mr-2"></i>
                            Tambah Baru
                        </button>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="glass-card rounded-2xl p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fas fa-id-card mr-2"></i>Cari Card ID
                            </label>
                            <input type="text" id="search-card" placeholder="Masukkan Card ID..." 
                                   class="w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white/50 dark:bg-gray-800/50 focus:outline-none focus:ring-2 focus:ring-[#0073aa]/30 focus:border-[#0073aa]">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                <i class="fas fa-user mr-2"></i>Cari Nama
                            </label>
                            <input type="text" id="search-nama" placeholder="Masukkan nama..." 
                                   class="w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white/50 dark:bg-gray-800/50 focus:outline-none focus:ring-2 focus:ring-[#0073aa]/30 focus:border-[#0073aa]">
                        </div>
                        <div class="flex items-end space-x-3">
                            <button onclick="applySearchFilter()" class="btn-primary px-5 py-2.5 rounded-lg font-semibold flex-1">
                                <i class="fas fa-search mr-2"></i>Cari
                            </button>
                            <button onclick="clearSearchFilter()" class="px-5 py-2.5 rounded-lg font-semibold bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600">
                                <i class="fas fa-redo"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Stats -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6" id="employee-stats">
                        <!-- Stats will be loaded here -->
                    </div>

                    <!-- Data Table -->
                    <div class="overflow-x-auto rounded-xl border border-gray-200 dark:border-gray-700">
                        <table class="data-table w-full">
                            <thead>
                                <tr>
                                    <th>Card ID</th>
                                    <th>NIK</th>
                                    <th>Nama</th>
                                    <th>Departemen</th>
                                    <th class="text-center">Pagi</th>
                                    <th class="text-center">Siang</th>
                                    <th class="text-center">Sore</th>
                                    <th class="text-center">Malam</th>
                                    <th class="text-center">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="data-table-body">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Empty State -->
                    <div id="no-data-message" class="empty-state hidden">
                        <i class="fas fa-users"></i>
                        <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2">Belum ada data karyawan</h3>
                        <p class="text-gray-500 dark:text-gray-400 mb-4">Mulai dengan menambahkan karyawan baru atau mengimpor data dari Excel</p>
                        <button onclick="openFormModal('create')" class="btn-primary px-5 py-2.5 rounded-lg font-semibold">
                            <i class="fas fa-user-plus mr-2"></i>Tambah Karyawan Pertama
                        </button>
                    </div>
                </div>
            </div>

            <!-- Log Absensi View -->
            <div id="absensi-view" class="space-y-6 hidden">
                <!-- Header -->
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-2">
                            <i class="fas fa-clipboard-list mr-3 text-[#0073aa]"></i>
                            Log Absensi
                        </h1>
                        <p class="text-gray-600 dark:text-gray-300">
                            Arsip 7 hari terakhir dengan analisis lengkap
                        </p>
                    </div>
                    <div class="flex items-center space-x-3 mt-4 md:mt-0">
                        <span class="text-sm text-gray-500 dark:text-gray-400" id="deletion-status"></span>
                        <button onclick="exportAllLogsToExcel()" class="btn-success px-5 py-2.5 rounded-lg font-semibold flex items-center">
                            <i class="fas fa-file-excel mr-2"></i>
                            Export Semua
                        </button>
                    </div>
                </div>

                <!-- Stats -->
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6" id="attendance-stats">
                    <!-- Stats will be loaded here -->
                </div>

                <!-- Period Tabs -->
                <div class="glass-card rounded-2xl p-6">
                    <div class="flex flex-wrap gap-2 mb-6">
                        <button onclick="filterLogsByPeriod('all')" class="period-tab period-tab-active px-4 py-2 rounded-lg font-medium">
                            Semua Periode
                        </button>
                        <button onclick="filterLogsByPeriod('pagi')" class="period-tab px-4 py-2 rounded-lg font-medium">
                            <i class="fas fa-sun mr-2"></i>Pagi
                        </button>
                        <button onclick="filterLogsByPeriod('siang')" class="period-tab px-4 py-2 rounded-lg font-medium">
                            <i class="fas fa-sun mr-2"></i>Siang
                        </button>
                        <button onclick="filterLogsByPeriod('sore')" class="period-tab px-4 py-2 rounded-lg font-medium">
                            <i class="fas fa-moon mr-2"></i>Sore
                        </button>
                        <button onclick="filterLogsByPeriod('malam')" class="period-tab px-4 py-2 rounded-lg font-medium">
                            <i class="fas fa-star mr-2"></i>Malam
                        </button>
                    </div>

                    <!-- Log Container -->
                    <div id="log-per-tanggal-container" class="space-y-4">
                        <!-- Logs will be loaded here -->
                    </div>

                    <!-- Loading State -->
                    <div id="loading-log-message" class="text-center py-12">
                        <div class="loading-spinner mx-auto"></div>
                        <p class="mt-4 text-gray-600 dark:text-gray-400">Memuat data absensi...</p>
                    </div>

                    <!-- Empty State -->
                    <div id="no-log-message" class="empty-state hidden">
                        <i class="fas fa-inbox"></i>
                        <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2">Tidak ada data absensi</h3>
                        <p class="text-gray-500 dark:text-gray-400">Belum ada aktivitas absensi dalam 7 hari terakhir</p>
                    </div>
                </div>
            </div>

            <!-- Pending Import View -->
            <div id="pending-import-view" class="space-y-6 hidden">
                <!-- Header -->
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-2">
                            <i class="fas fa-clock mr-3 text-[#0073aa]"></i>
                            Pending Import
                        </h1>
                        <p class="text-gray-600 dark:text-gray-300">
                            Data yang menunggu sinkronisasi ke database (Update otomatis jam 21:00)
                        </p>
                    </div>
                    <div class="flex items-center space-x-3 mt-4 md:mt-0">
                        <button onclick="checkPendingImports()" class="btn-primary px-5 py-2.5 rounded-lg font-semibold flex items-center">
                            <i class="fas fa-sync-alt mr-2"></i>
                            Refresh
                        </button>
                        <button onclick="forceSyncNow()" class="btn-success px-5 py-2.5 rounded-lg font-semibold flex items-center">
                            <i class="fas fa-bolt mr-2"></i>
                            Sinkronisasi Sekarang
                        </button>
                    </div>
                </div>

                <!-- Import Schedule Info -->
                <div class="glass-card rounded-2xl p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl border border-blue-200 dark:border-blue-800">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center mr-3">
                                    <i class="fas fa-clock text-blue-600 dark:text-blue-400"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Jadwal Sinkronisasi</p>
                                    <p class="text-lg font-bold text-gray-800 dark:text-white">Setiap Jam 21:00</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-gradient-to-r from-emerald-50 to-teal-50 dark:from-emerald-900/20 dark:to-teal-900/20 rounded-xl border border-emerald-200 dark:border-emerald-800">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-lg bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center mr-3">
                                    <i class="fas fa-database text-emerald-600 dark:text-emerald-400"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Status Database</p>
                                    <p class="text-lg font-bold text-gray-800 dark:text-white" id="db-status">Online</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 rounded-xl border border-amber-200 dark:border-amber-800">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-lg bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center mr-3">
                                    <i class="fas fa-history text-amber-600 dark:text-amber-400"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Terakhir Update</p>
                                    <p class="text-lg font-bold text-gray-800 dark:text-white" id="last-sync">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pending Imports List -->
                <div class="glass-card rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-800 dark:text-white">
                            <i class="fas fa-list mr-2 text-[#0073aa]"></i>
                            Daftar Pending Import
                        </h2>
                        <div class="text-sm text-gray-600 dark:text-gray-400">
                            Total: <span id="total-pending" class="font-bold">0</span> data
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <th class="pb-3 text-left font-semibold">ID</th>
                                    <th class="pb-3 text-left font-semibold">Waktu Import</th>
                                    <th class="pb-3 text-left font-semibold">Jumlah Data</th>
                                    <th class="pb-3 text-left font-semibold">Status</th>
                                    <th class="pb-3 text-left font-semibold">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="pending-imports-list">
                                <!-- Pending imports will be loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Empty State -->
                    <div id="no-pending-message" class="empty-state hidden">
                        <i class="fas fa-inbox"></i>
                        <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mb-2">Tidak ada pending import</h3>
                        <p class="text-gray-500 dark:text-gray-400 mb-4">Semua data sudah tersinkronisasi dengan database</p>
                        <button onclick="openImportModal()" class="btn-primary px-5 py-2.5 rounded-lg font-semibold">
                            <i class="fas fa-file-import mr-2"></i>Import Data Baru
                        </button>
                    </div>
                </div>

                <!-- Pending Data Preview -->
                <div class="glass-card rounded-2xl p-6">
                    <h2 class="text-xl font-bold text-gray-800 dark:text-white mb-6">
                        <i class="fas fa-eye mr-2 text-[#0073aa]"></i>
                        Preview Data Pending
                    </h2>
                    <div id="pending-data-preview" class="overflow-x-auto">
                        <!-- Data preview will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Laporan View -->
            <div id="laporan-view" class="space-y-6 hidden">
                <!-- Header -->
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-2">
                            <i class="fas fa-chart-bar mr-3 text-[#0073aa]"></i>
                            Analisis & Laporan
                        </h1>
                        <p class="text-gray-600 dark:text-gray-300">
                            Insight mendalam dan statistik absensi
                        </p>
                    </div>
                    <div class="flex items-center space-x-3 mt-4 md:mt-0">
                        <select id="report-period" onchange="loadReport()" class="px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white/50 dark:bg-gray-800/50 focus:outline-none focus:ring-2 focus:ring-[#0073aa]/30 focus:border-[#0073aa]">
                            <option value="7">7 Hari Terakhir</option>
                            <option value="30">30 Hari Terakhir</option>
                            <option value="90">90 Hari Terakhir</option>
                        </select>
                        <button onclick="generateReport()" class="btn-primary px-5 py-2.5 rounded-lg font-semibold flex items-center">
                            <i class="fas fa-download mr-2"></i>
                            Generate Report
                        </button>
                    </div>
                </div>

                <!-- Analytics Stats -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6" id="analytics-stats">
                    <!-- Stats will be loaded here -->
                </div>

                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="glass-card rounded-2xl p-6">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-6">
                            <i class="fas fa-chart-line mr-2 text-[#0073aa]"></i>
                            Trend Absensi Harian
                        </h3>
                        <div class="chart-container">
                            <canvas id="attendanceTrendChart"></canvas>
                        </div>
                    </div>
                    <div class="glass-card rounded-2xl p-6">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-6">
                            <i class="fas fa-pie-chart mr-2 text-[#0073aa]"></i>
                            Distribusi Status
                        </h3>
                        <div class="chart-container">
                            <canvas id="statusDistributionChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Department Analytics -->
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-6">
                        <i class="fas fa-building mr-2 text-[#0073aa]"></i>
                        Analisis per Departemen
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <th class="pb-3 text-left font-semibold">Departemen</th>
                                    <th class="pb-3 text-left font-semibold">Total Karyawan</th>
                                    <th class="pb-3 text-left font-semibold">Total Absensi</th>
                                    <th class="pb-3 text-left font-semibold">Rata-rata/Hari</th>
                                    <th class="pb-3 text-left font-semibold">% Kehadiran</th>
                                </tr>
                            </thead>
                            <tbody id="department-analytics-body">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Insights -->
                <div class="glass-card rounded-2xl p-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-6">
                        <i class="fas fa-lightbulb mr-2 text-[#ffb900]"></i>
                        Insight & Rekomendasi
                    </h3>
                    <div id="insights-container" class="space-y-4">
                        <!-- Insights will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Pengaturan View -->
            <div id="pengaturan-view" class="space-y-6 hidden">
                <!-- Header -->
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-2">
                            <i class="fas fa-cog mr-3 text-[#0073aa]"></i>
                            Pengaturan Sistem
                        </h1>
                        <p class="text-gray-600 dark:text-gray-300">
                            Konfigurasi dan preferensi sistem
                        </p>
                    </div>
                </div>

                <!-- Settings Tabs -->
                <div class="glass-card rounded-2xl">
                    <div class="border-b border-gray-200 dark:border-gray-700">
                        <nav class="flex space-x-4 px-6">
                            <button onclick="switchSettingsTab('umum')" class="settings-tab settings-tab-active py-4 font-medium">
                                <i class="fas fa-cog mr-2"></i>Umum
                            </button>
                            <button onclick="switchSettingsTab('sinkronisasi')" class="settings-tab py-4 font-medium">
                                <i class="fas fa-sync-alt mr-2"></i>Sinkronisasi
                            </button>
                            <button onclick="switchSettingsTab('notifikasi')" class="settings-tab py-4 font-medium">
                                <i class="fas fa-bell mr-2"></i>Notifikasi
                            </button>
                            <button onclick="switchSettingsTab('backup')" class="settings-tab py-4 font-medium">
                                <i class="fas fa-database mr-2"></i>Backup
                            </button>
                        </nav>
                    </div>

                    <!-- Settings Content -->
                    <div class="p-6">
                        <!-- Umum Settings -->
                        <div id="umum-settings" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Nama Perusahaan
                                    </label>
                                    <input type="text" class="w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white/50 dark:bg-gray-800/50" value="PT. Contoh Perusahaan">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Zona Waktu
                                    </label>
                                    <select class="w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white/50 dark:bg-gray-800/50">
                                        <option>Asia/Jakarta (WIB)</option>
                                        <option>Asia/Jayapura (WIT)</option>
                                        <option>Asia/Makassar (WITA)</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Deskripsi Sistem
                                </label>
                                <textarea class="w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white/50 dark:bg-gray-800/50" rows="3"></textarea>
                            </div>
                        </div>

                        <!-- Sinkronisasi Settings -->
                        <div id="sinkronisasi-settings" class="space-y-6 hidden">
                            <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl border border-blue-200 dark:border-blue-800">
                                <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3">
                                    <i class="fas fa-sync-alt mr-2 text-blue-500"></i>
                                    Jadwal Sinkronisasi
                                </h4>
                                
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Waktu Sinkronisasi Harian
                                        </label>
                                        <input type="time" id="sync-time" value="21:00" 
                                               class="w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white/50 dark:bg-gray-800/50">
                                    </div>

                                    <div class="flex items-center justify-between p-3 bg-white dark:bg-gray-800/50 rounded-lg border">
                                        <div>
                                            <p class="font-medium text-gray-800 dark:text-white">Sinkronisasi Otomatis</p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Update database secara otomatis sesuai jadwal</p>
                                        </div>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="auto-sync" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>

                                    <div class="timeline mt-6">
                                        <div class="timeline-item">
                                            <p class="font-medium text-gray-800 dark:text-white">1. Import Data ke Spreadsheet</p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Data masuk ke sheet "PendingImport" untuk review</p>
                                        </div>
                                        <div class="timeline-item">
                                            <p class="font-medium text-gray-800 dark:text-white">2. Data Disimpan Sementara</p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Data tetap aman di Google Sheets sampai waktu sinkron</p>
                                        </div>
                                        <div class="timeline-item">
                                            <p class="font-medium text-gray-800 dark:text-white">3. Sinkronisasi ke Supabase</p>
                                            <p class="text-sm text-gray-600 dark:text-gray-400">Data dipindahkan ke database sesuai jadwal</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        URL Google Apps Script
                                    </label>
                                    <input type="text" id="gas-url" value="https://script.google.com/macros/s/AKfycbwZ_4ycgdQYQjaL1Ihlg95BD7jgn7f8c05P2HTV4QLF1m1aXNOVGA0SdkEobfEKNgrxuw/exec" 
                                           class="w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white/50 dark:bg-gray-800/50">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Nama Spreadsheet
                                    </label>
                                    <input type="text" id="spreadsheet-name" value="Sinkronisasi Data Supabase" 
                                           class="w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white/50 dark:bg-gray-800/50">
                                </div>
                            </div>

                            <div class="flex items-center justify-between p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800">
                                <div>
                                    <p class="font-medium text-amber-800 dark:text-amber-300">Mode Manual Override</p>
                                    <p class="text-sm text-amber-600 dark:text-amber-400">Izinkan sinkronisasi manual tanpa menunggu jadwal</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="manual-override" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>

                            <button onclick="testSyncConnection()" class="btn-primary px-5 py-2.5 rounded-lg font-semibold w-full">
                                <i class="fas fa-plug mr-2"></i>Test Koneksi Sinkronisasi
                            </button>
                        </div>

                        <!-- Notifikasi Settings -->
                        <div id="notifikasi-settings" class="space-y-6 hidden">
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg">
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white">Notifikasi Sinkronisasi</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Kirim notifikasi saat sinkronisasi selesai</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>

                                <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg">
                                    <div>
                                        <p class="font-medium text-gray-800 dark:text-white">Notifikasi Error</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Kirim notifikasi saat terjadi error</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Backup Settings -->
                        <div id="backup-settings" class="space-y-6 hidden">
                            <div class="space-y-4">
                                <div class="p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg">
                                    <p class="font-medium text-gray-800 dark:text-white mb-2">Backup Otomatis</p>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Cadangkan data secara otomatis setiap hari</p>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>

                                <div class="p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg">
                                    <p class="font-medium text-gray-800 dark:text-white mb-2">Waktu Backup</p>
                                    <input type="time" class="w-full px-4 py-2 rounded-lg border" value="02:00">
                                </div>

                                <button class="w-full btn-primary py-3 rounded-lg font-semibold">
                                    <i class="fas fa-download mr-2"></i>Backup Sekarang
                                </button>
                            </div>
                        </div>

                        <!-- Save Button -->
                        <div class="pt-6 border-t border-gray-200 dark:border-gray-700">
                            <button onclick="saveSettings()" class="btn-primary px-6 py-3 rounded-lg font-semibold">
                                <i class="fas fa-save mr-2"></i>Simpan Perubahan
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="p-6 border-t border-gray-200 dark:border-gray-700">
            <div class="text-center text-gray-600 dark:text-gray-400 text-sm">
                <p>Â© 2024 AdminPro Sistem Absensi. Versi 2.0.0</p>
                <p class="mt-1">Sinkronisasi berikutnya: <span id="footer-sync-time">21:00</span></p>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <!-- Import Modal -->
    <div id="import-modal" class="modal-overlay fixed inset-0 z-50 hidden">
        <div class="modal-content max-w-4xl w-11/12 mx-auto mt-10">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 dark:text-white">
                        <i class="fas fa-file-import mr-2 text-[#0073aa]"></i>
                        Import Data Karyawan (Pending)
                    </h3>
                    <button onclick="closeImportModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <form id="import-form">
                    <div id="step-upload" class="space-y-6">
                        <div class="p-6 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl border border-blue-200 dark:border-blue-800">
                            <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3">
                                <i class="fas fa-upload mr-2 text-blue-500"></i>
                                Unggah File Excel
                            </h4>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Pilih File Excel (.xlsx, .xls)
                                </label>
                                <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-[#0073aa] dark:hover:border-[#0073aa] transition cursor-pointer" onclick="document.getElementById('excel-file-input').click()">
                                    <div class="space-y-1 text-center">
                                        <i class="fas fa-file-excel text-4xl text-[#46b450]"></i>
                                        <div class="flex text-sm text-gray-600 dark:text-gray-400">
                                            <span class="relative cursor-pointer rounded-md font-medium text-[#0073aa] dark:text-[#00a0d2] hover:text-[#005a87] dark:hover:text-[#0073aa]">
                                                <span>Upload file</span>
                                                <input id="excel-file-input" type="file" class="sr-only" accept=".xlsx, .xls">
                                            </span>
                                            <p class="pl-1">atau drag & drop</p>
                                        </div>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">.xlsx, .xls (maks 5MB)</p>
                                    </div>
                                </div>
                            </div>

                            <div class="p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 rounded-lg border border-amber-200 dark:border-amber-800">
                                <div class="flex items-start">
                                    <i class="fas fa-info-circle text-amber-500 mt-1 mr-3"></i>
                                    <div>
                                        <p class="text-sm font-semibold text-amber-700 dark:text-amber-400">Sistem Pending Import</p>
                                        <p class="text-xs text-amber-600 dark:text-amber-300 mt-1">
                                            Data akan disimpan di Google Sheets terlebih dahulu (sheet "PendingImport"). 
                                            Sinkronisasi ke Supabase akan dilakukan otomatis setiap jam <span id="modal-sync-time">21:00</span>.
                                            Anda bisa review data sebelum sinkronisasi.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="step-review" class="hidden space-y-6">
                        <!-- Review content will be loaded here -->
                    </div>

                    <div class="flex justify-between pt-6 border-t border-gray-200 dark:border-gray-700">
                        <button type="button" onclick="closeImportModal()" class="px-5 py-2.5 rounded-lg font-medium bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                            Batal
                        </button>
                        <div class="flex space-x-3">
                            <button type="button" id="review-button" onclick="parseExcelFile()" class="btn-primary px-5 py-2.5 rounded-lg font-medium flex items-center">
                                <i class="fas fa-eye mr-2"></i>
                                Review Data
                            </button>
                            <button type="submit" id="import-submit-button" class="btn-success px-5 py-2.5 rounded-lg font-medium flex items-center hidden">
                                <i class="fas fa-paper-plane mr-2"></i>
                                Simpan ke Pending Import
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Import Progress Modal -->
    <div id="import-progress-modal" class="modal-overlay fixed inset-0 z-50 hidden">
        <div class="modal-content max-w-md w-11/12 mx-auto mt-10">
            <div class="p-6">
                <div class="text-center">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2" id="progress-title">Menyimpan ke Pending Import</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4" id="progress-message">
                        Menyimpan data ke Google Sheets...
                    </p>
                    
                    <div class="import-progress mb-4">
                        <div class="import-progress-fill" id="progress-bar"></div>
                    </div>
                    
                    <div class="text-sm text-gray-500 dark:text-gray-400">
                        <span id="progress-percentage">0%</span> - 
                        <span id="progress-status">Memproses...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sync Confirmation Modal -->
    <div id="sync-confirm-modal" class="modal-overlay fixed inset-0 z-50 hidden">
        <div class="modal-content max-w-md w-11/12 mx-auto mt-10">
            <div class="p-6">
                <div class="text-center">
                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 dark:bg-blue-900/30 mb-4">
                        <i class="fas fa-sync-alt text-blue-600 dark:text-blue-400 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Konfirmasi Sinkronisasi</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-6">
                        Anda akan melakukan sinkronisasi manual. 
                        Semua data di sheet "PendingImport" akan dipindahkan ke Supabase.
                        <br><br>
                        <span class="font-medium">Pastikan data sudah benar!</span>
                    </p>
                    <div class="flex justify-center space-x-3">
                        <button type="button" onclick="closeSyncConfirmModal()" class="px-5 py-2.5 rounded-lg font-medium bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                            Batal
                        </button>
                        <button type="button" onclick="startManualSync()" class="btn-primary px-5 py-2.5 rounded-lg font-medium flex items-center">
                            <i class="fas fa-bolt mr-2"></i>
                            Ya, Sinkronisasi Sekarang
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sync Progress Modal -->
    <div id="sync-progress-modal" class="modal-overlay fixed inset-0 z-50 hidden">
        <div class="modal-content max-w-md w-11/12 mx-auto mt-10">
            <div class="p-6">
                <div class="text-center">
                    <div class="loading-spinner mx-auto mb-4"></div>
                    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Sinkronisasi ke Supabase</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4" id="sync-message">
                        Memproses sinkronisasi...
                    </p>
                    
                    <div class="import-progress mb-4">
                        <div class="import-progress-fill" id="sync-progress-bar"></div>
                    </div>
                    
                    <div class="text-sm text-gray-500 dark:text-gray-400">
                        <span id="sync-percentage">0%</span> - 
                        <span id="sync-status">Memindahkan data...</span>
                    </div>

                    <div class="mt-6 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600 dark:text-gray-400">Data diproses:</span>
                            <span class="font-medium" id="sync-processed">0</span>
                        </div>
                        <div class="flex justify-between text-sm mt-1">
                            <span class="text-gray-600 dark:text-gray-400">Berhasil:</span>
                            <span class="font-medium text-[#46b450]" id="sync-success">0</span>
                        </div>
                        <div class="flex justify-between text-sm mt-1">
                            <span class="text-gray-600 dark:text-gray-400">Gagal:</span>
                            <span class="font-medium text-[#dc3232]" id="sync-failed">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Form Modal -->
    <div id="form-modal" class="modal-overlay fixed inset-0 z-50 hidden">
        <!-- Form modal content remains the same -->
        <!-- ... -->
    </div>

    <!-- Delete Modal -->
    <div id="delete-modal" class="modal-overlay fixed inset-0 z-50 hidden">
        <!-- Delete modal content remains the same -->
        <!-- ... -->
    </div>

    <script>
        // Konfigurasi
        const SUPABASE_URL = 'https://ymzcvyumplerqccaplxi.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InltemN2eXVtcGxlcnFjY2FwbHhpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNjk3ODUsImV4cCI6MjA3ODY0NTc4NX0.XtX9NMHp3gINRP3zSA-PnC73tiI4vPVcB4D2A13c1TI';
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwZ_4ycgdQYQjaL1Ihlg95BD7jgn7f8c05P2HTV4QLF1m1aXNOVGA0SdkEobfEKNgrxuw/exec';
        const TABLE_NAME = 'data_master';
        const LOG_TABLE_NAME = 'log_absen';
        const REQUIRED_HEADERS = ['Card ID', 'NIK', 'Nama', 'Departemen', 'Pagi', 'Siang', 'Sore', 'Malam'];
        
        // Konfigurasi Sinkronisasi
        const DEFAULT_SYNC_TIME = '21:00'; // Jam 9 malam
        const SPREADSHEET_NAME = 'Sinkronisasi Data Supabase';
        const PENDING_SHEET_NAME = 'PendingImport';
        const SYNC_LOG_SHEET_NAME = 'SyncLog';

        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // State Management
        let currentView = 'dashboard';
        let currentTheme = localStorage.getItem('theme') || 'light';
        let isSidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
        let parsedImportData = [];
        let activeCardIds = [];
        let currentMode = 'create';
        let cardIdToDelete = null;
        let allAbsensiLogs = [];
        let currentPeriodFilter = 'all';
        let currentSettingsTab = 'umum';
        
        // Settings dari localStorage
        let syncTime = localStorage.getItem('syncTime') || DEFAULT_SYNC_TIME;
        let autoSync = localStorage.getItem('autoSync') !== 'false'; // default true
        let manualOverride = localStorage.getItem('manualOverride') !== 'false'; // default true
        let gasUrl = localStorage.getItem('gasUrl') || GOOGLE_APPS_SCRIPT_URL;
        let spreadsheetName = localStorage.getItem('spreadsheetName') || SPREADSHEET_NAME;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });

        // Initialize application
        function initApp() {
            initTheme();
            initSidebar();
            initCurrentDate();
            initEventListeners();
            initSyncTime();
            checkAdminSession();
            
            // Cek pending imports setiap 30 detik
            setInterval(checkPendingImports, 30000);
            
            // Cek apakah sudah waktunya sinkronisasi
            setInterval(checkSyncTime, 60000); // Cek setiap menit
        }

        // Initialize sync time display
        function initSyncTime() {
            document.getElementById('modal-sync-time').textContent = syncTime;
            document.getElementById('footer-sync-time').textContent = syncTime;
            document.getElementById('next-sync-time').textContent = syncTime;
            document.getElementById('sync-time').value = syncTime;
            document.getElementById('auto-sync').checked = autoSync;
            document.getElementById('manual-override').checked = manualOverride;
            document.getElementById('gas-url').value = gasUrl;
            document.getElementById('spreadsheet-name').value = spreadsheetName;
        }

        // Cek apakah sudah waktunya sinkronisasi
        function checkSyncTime() {
            if (!autoSync) return;
            
            const now = new Date();
            const currentHour = now.getHours().toString().padStart(2, '0');
            const currentMinute = now.getMinutes().toString().padStart(2, '0');
            const currentTime = `${currentHour}:${currentMinute}`;
            
            if (currentTime === syncTime) {
                // Jalankan sinkronisasi
                startAutoSync();
            }
        }

        // Jalankan sinkronisasi otomatis
        async function startAutoSync() {
            console.log('Memulai sinkronisasi otomatis...');
            
            try {
                // Ambil data dari Google Sheets
                const response = await fetch(`${gasUrl}?action=get_pending_data`, {
                    method: 'GET'
                });
                
                if (!response.ok) {
                    throw new Error('Gagal mengambil data dari Google Sheets');
                }
                
                const result = await response.json();
                
                if (result.status === 'success' && result.data && result.data.length > 0) {
                    // Sinkronkan ke Supabase
                    await syncToSupabase(result.data);
                    
                    // Hapus data dari pending setelah berhasil
                    await clearPendingData();
                    
                    // Update UI
                    checkPendingImports();
                    showGlobalMessage('Sinkronisasi otomatis berhasil!', 'success');
                }
            } catch (error) {
                console.error('Error sinkronisasi otomatis:', error);
                // Catat error ke log
                await logSyncError('Auto Sync Failed', error.message);
            }
        }

        // Ambil data pending dari Google Sheets
        async function getPendingData() {
            try {
                const response = await fetch(`${gasUrl}?action=get_pending_data`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    return result.data || [];
                } else {
                    throw new Error(result.message || 'Gagal mengambil data pending');
                }
            } catch (error) {
                console.error('Error mengambil data pending:', error);
                showGlobalMessage(`Gagal mengambil data pending: ${error.message}`, 'error');
                return [];
            }
        }

        // Simpan data ke Google Sheets (Pending Import)
        async function saveToPendingImport(data) {
            try {
                const payload = {
                    action: 'save_pending_import',
                    data: data,
                    metadata: {
                        timestamp: new Date().toISOString(),
                        total_records: data.length,
                        user: document.getElementById('admin-name').textContent
                    }
                };
                
                const response = await fetch(gasUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `payload=${encodeURIComponent(JSON.stringify(payload))}`
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    return {
                        success: true,
                        message: result.message,
                        pending_count: result.pending_count || 0
                    };
                } else {
                    throw new Error(result.message || 'Gagal menyimpan ke pending import');
                }
            } catch (error) {
                console.error('Error menyimpan ke pending import:', error);
                return {
                    success: false,
                    message: error.message
                };
            }
        }

        // Sinkronkan data ke Supabase
        async function syncToSupabase(data) {
            let successCount = 0;
            let failedCount = 0;
            const errors = [];
            
            // Update progress
            updateSyncProgress(0, data.length, 0, 0);
            
            for (let i = 0; i < data.length; i++) {
                const item = data[i];
                
                try {
                    // Cek apakah data sudah ada
                    const { data: existing } = await supabaseClient
                        .from(TABLE_NAME)
                        .select('card')
                        .eq('card', item.card)
                        .single();
                    
                    if (existing) {
                        // Update data yang sudah ada
                        const { error } = await supabaseClient
                            .from(TABLE_NAME)
                            .update({
                                nik: item.nik,
                                nama: item.nama,
                                departemen: item.departemen,
                                pagi: item.pagi,
                                siang: item.siang,
                                sore: item.sore,
                                malam: item.malam,
                                updated_at: new Date().toISOString()
                            })
                            .eq('card', item.card);
                        
                        if (error) throw error;
                        successCount++;
                    } else {
                        // Insert data baru
                        const { error } = await supabaseClient
                            .from(TABLE_NAME)
                            .insert([{
                                card: item.card,
                                nik: item.nik,
                                nama: item.nama,
                                departemen: item.departemen,
                                pagi: item.pagi,
                                siang: item.siang,
                                sore: item.sore,
                                malam: item.malam,
                                created_at: new Date().toISOString()
                            }]);
                        
                        if (error) throw error;
                        successCount++;
                    }
                } catch (error) {
                    console.error(`Error sinkronisasi data ${item.card}:`, error);
                    failedCount++;
                    errors.push({
                        card: item.card,
                        error: error.message
                    });
                }
                
                // Update progress
                const progress = Math.round(((i + 1) / data.length) * 100);
                updateSyncProgress(progress, data.length, successCount, failedCount);
            }
            
            // Catat log sinkronisasi
            await logSyncResult(data.length, successCount, failedCount, errors);
            
            return {
                total: data.length,
                success: successCount,
                failed: failedCount,
                errors: errors
            };
        }

        // Hapus data dari pending setelah sinkronisasi
        async function clearPendingData() {
            try {
                const response = await fetch(`${gasUrl}?action=clear_pending_data`, {
                    method: 'GET'
                });
                
                if (!response.ok) {
                    throw new Error('Gagal menghapus data pending');
                }
                
                const result = await response.json();
                return result.status === 'success';
            } catch (error) {
                console.error('Error menghapus data pending:', error);
                return false;
            }
        }

        // Catat hasil sinkronisasi ke Google Sheets
        async function logSyncResult(total, success, failed, errors) {
            try {
                const logData = {
                    action: 'log_sync_result',
                    data: {
                        timestamp: new Date().toISOString(),
                        total_records: total,
                        success_count: success,
                        failed_count: failed,
                        errors: errors,
                        sync_type: manualOverride ? 'manual' : 'auto'
                    }
                };
                
                await fetch(gasUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `payload=${encodeURIComponent(JSON.stringify(logData))}`
                });
            } catch (error) {
                console.error('Error mencatat log sync:', error);
            }
        }

        // Catat error sinkronisasi
        async function logSyncError(type, message) {
            try {
                const logData = {
                    action: 'log_error',
                    data: {
                        timestamp: new Date().toISOString(),
                        error_type: type,
                        message: message,
                        user: document.getElementById('admin-name').textContent
                    }
                };
                
                await fetch(gasUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `payload=${encodeURIComponent(JSON.stringify(logData))}`
                });
            } catch (error) {
                console.error('Error mencatat error log:', error);
            }
        }

        // Update progress sinkronisasi
        function updateSyncProgress(percentage, total, success, failed) {
            const progressBar = document.getElementById('sync-progress-bar');
            const syncPercentage = document.getElementById('sync-percentage');
            const syncStatus = document.getElementById('sync-status');
            const syncProcessed = document.getElementById('sync-processed');
            const syncSuccess = document.getElementById('sync-success');
            const syncFailed = document.getElementById('sync-failed');
            
            if (progressBar) {
                progressBar.style.width = `${percentage}%`;
                syncPercentage.textContent = `${percentage}%`;
                syncStatus.textContent = `Memproses ${percentage}%`;
                syncProcessed.textContent = total;
                syncSuccess.textContent = success;
                syncFailed.textContent = failed;
            }
        }

        // Cek pending imports
        async function checkPendingImports() {
            try {
                const data = await getPendingData();
                const pendingCount = data.length;
                
                // Update badge
                document.getElementById('pending-count').textContent = pendingCount;
                document.getElementById('notification-count').textContent = pendingCount;
                document.getElementById('total-pending').textContent = pendingCount;
                
                // Update dashboard summary
                updatePendingSummary(data);
                
                // Update pending imports list jika view aktif
                if (currentView === 'pending-import') {
                    updatePendingImportsList(data);
                    updatePendingDataPreview(data);
                }
                
                // Update last sync time
                if (data.length > 0 && data[0].import_timestamp) {
                    const lastImport = new Date(data[0].import_timestamp);
                    document.getElementById('last-sync').textContent = 
                        lastImport.toLocaleDateString('id-ID') + ' ' + 
                        lastImport.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                }
                
            } catch (error) {
                console.error('Error checking pending imports:', error);
            }
        }

        // Update pending summary di dashboard
        function updatePendingSummary(data) {
            const pendingSummary = document.getElementById('pending-summary');
            
            if (data.length === 0) {
                pendingSummary.innerHTML = `
                    <div class="text-center py-6">
                        <i class="fas fa-check-circle text-4xl text-[#46b450] mb-4"></i>
                        <p class="text-gray-600 dark:text-gray-400">Tidak ada pending import</p>
                        <p class="text-sm text-gray-500 dark:text-gray-500 mt-1">Semua data sudah tersinkronisasi</p>
                    </div>
                `;
            } else {
                const latestImport = new Date(data[0].import_timestamp || new Date());
                const timeAgo = getTimeAgo(latestImport);
                
                pendingSummary.innerHTML = `
                    <div class="p-4 bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 rounded-xl border border-amber-200 dark:border-amber-800">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-lg bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center mr-3">
                                    <i class="fas fa-clock text-amber-600 dark:text-amber-400"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">Pending Import</p>
                                    <p class="text-xl font-bold text-gray-800 dark:text-white">${data.length} data</p>
                                </div>
                            </div>
                            <span class="status-badge status-pending">Pending</span>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Import terakhir:</span>
                                <span class="font-medium">${timeAgo}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600 dark:text-gray-400">Sinkronisasi berikutnya:</span>
                                <span class="font-medium">${syncTime}</span>
                            </div>
                        </div>
                        <button onclick="switchView('pending-import')" class="w-full mt-4 px-4 py-2 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded-lg font-medium hover:bg-amber-200 dark:hover:bg-amber-800/50 transition">
                            <i class="fas fa-eye mr-2"></i>Lihat Detail
                        </button>
                    </div>
                `;
            }
        }

        // Update pending imports list
        function updatePendingImportsList(data) {
            const listContainer = document.getElementById('pending-imports-list');
            const noPendingMsg = document.getElementById('no-pending-message');
            
            if (data.length === 0) {
                listContainer.innerHTML = '';
                noPendingMsg.classList.remove('hidden');
                return;
            }
            
            noPendingMsg.classList.add('hidden');
            
            // Group by import timestamp
            const importsByTime = {};
            data.forEach(item => {
                const timestamp = item.import_timestamp || 'Unknown';
                if (!importsByTime[timestamp]) {
                    importsByTime[timestamp] = [];
                }
                importsByTime[timestamp].push(item);
            });
            
            let html = '';
            Object.keys(importsByTime).forEach((timestamp, index) => {
                const items = importsByTime[timestamp];
                const importTime = new Date(timestamp);
                const timeAgo = getTimeAgo(importTime);
                const importId = `import-${index + 1}`;
                
                html += `
                    <tr class="border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50">
                        <td class="py-3">
                            <span class="font-mono text-sm">${importId}</span>
                        </td>
                        <td class="py-3">
                            <div>
                                <p class="font-medium">${importTime.toLocaleDateString('id-ID')}</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">${importTime.toLocaleTimeString('id-ID')}</p>
                                <p class="text-xs text-gray-400 dark:text-gray-500">${timeAgo}</p>
                            </div>
                        </td>
                        <td class="py-3">
                            <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 rounded text-sm">
                                ${items.length} data
                            </span>
                        </td>
                        <td class="py-3">
                            <span class="status-badge status-pending">Menunggu</span>
                        </td>
                        <td class="py-3">
                            <button onclick="viewImportDetails('${timestamp}')" class="px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded text-sm hover:bg-gray-200 dark:hover:bg-gray-700 transition">
                                <i class="fas fa-eye mr-1"></i>Lihat
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            listContainer.innerHTML = html;
        }

        // Update pending data preview
        function updatePendingDataPreview(data) {
            const previewContainer = document.getElementById('pending-data-preview');
            
            if (data.length === 0) {
                previewContainer.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-inbox text-4xl text-gray-300 dark:text-gray-600 mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400">Tidak ada data pending</p>
                    </div>
                `;
                return;
            }
            
            // Tampilkan 10 data pertama
            const previewData = data.slice(0, 10);
            
            let html = `
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-gray-200 dark:border-gray-700">
                            <th class="pb-2 text-left font-semibold">Card ID</th>
                            <th class="pb-2 text-left font-semibold">NIK</th>
                            <th class="pb-2 text-left font-semibold">Nama</th>
                            <th class="pb-2 text-left font-semibold">Departemen</th>
                            <th class="pb-2 text-left font-semibold">Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            previewData.forEach(item => {
                html += `
                    <tr class="border-b border-gray-100 dark:border-gray-800">
                        <td class="py-2 font-mono">${item.card}</td>
                        <td class="py-2">${item.nik}</td>
                        <td class="py-2">${item.nama}</td>
                        <td class="py-2">
                            <span class="px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded text-xs">
                                ${item.departemen}
                            </span>
                        </td>
                        <td class="py-2">
                            <span class="status-badge status-pending">Pending</span>
                        </td>
                    </tr>
                `;
            });
            
            if (data.length > 10) {
                html += `
                    <tr>
                        <td colspan="5" class="py-3 text-center text-gray-500 dark:text-gray-400">
                            ... dan ${data.length - 10} data lainnya
                        </td>
                    </tr>
                `;
            }
            
            html += `
                    </tbody>
                </table>
                <div class="mt-4 text-sm text-gray-600 dark:text-gray-400">
                    <i class="fas fa-info-circle mr-2"></i>
                    Total ${data.length} data menunggu sinkronisasi jam ${syncTime}
                </div>
            `;
            
            previewContainer.innerHTML = html;
        }

        // View import details
        function viewImportDetails(timestamp) {
            // Implementasi detail view jika diperlukan
            showGlobalMessage(`Menampilkan detail import dari ${new Date(timestamp).toLocaleString('id-ID')}`, 'info');
        }

        // Force sync sekarang
        function forceSyncNow() {
            if (!manualOverride) {
                showGlobalMessage('Mode manual override dinonaktifkan di pengaturan', 'warning');
                return;
            }
            
            openSyncConfirmModal();
        }

        // Open sync confirmation modal
        function openSyncConfirmModal() {
            document.getElementById('sync-confirm-modal').classList.remove('hidden');
        }

        // Close sync confirmation modal
        function closeSyncConfirmModal() {
            document.getElementById('sync-confirm-modal').classList.add('hidden');
        }

        // Start manual sync
        async function startManualSync() {
            closeSyncConfirmModal();
            openSyncProgressModal();
            
            try {
                // Ambil data pending
                const data = await getPendingData();
                
                if (data.length === 0) {
                    showGlobalMessage('Tidak ada data pending untuk disinkronisasi', 'info');
                    closeSyncProgressModal();
                    return;
                }
                
                // Sinkronkan ke Supabase
                const result = await syncToSupabase(data);
                
                // Hapus dari pending jika berhasil
                if (result.success > 0) {
                    await clearPendingData();
                }
                
                // Tampilkan hasil
                closeSyncProgressModal();
                
                if (result.failed === 0) {
                    showGlobalMessage(`Berhasil sinkronisasi ${result.success} data ke Supabase`, 'success');
                } else {
                    showGlobalMessage(
                        `Sinkronisasi selesai: ${result.success} berhasil, ${result.failed} gagal`, 
                        result.failed > 0 ? 'warning' : 'success'
                    );
                }
                
                // Refresh data
                checkPendingImports();
                if (currentView === 'karyawan') {
                    fetchData();
                }
                
            } catch (error) {
                console.error('Error manual sync:', error);
                closeSyncProgressModal();
                showGlobalMessage(`Gagal sinkronisasi: ${error.message}`, 'error');
            }
        }

        // Open sync progress modal
        function openSyncProgressModal() {
            document.getElementById('sync-progress-modal').classList.remove('hidden');
        }

        // Close sync progress modal
        function closeSyncProgressModal() {
            document.getElementById('sync-progress-modal').classList.add('hidden');
        }

        // Test sync connection
        async function testSyncConnection() {
            try {
                const response = await fetch(`${gasUrl}?action=test_connection`, {
                    method: 'GET'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showGlobalMessage('Koneksi ke Google Apps Script berhasil!', 'success');
                } else {
                    throw new Error(result.message || 'Koneksi gagal');
                }
            } catch (error) {
                showGlobalMessage(`Test koneksi gagal: ${error.message}`, 'error');
            }
        }

        // Save settings
        function saveSettings() {
            syncTime = document.getElementById('sync-time').value;
            autoSync = document.getElementById('auto-sync').checked;
            manualOverride = document.getElementById('manual-override').checked;
            gasUrl = document.getElementById('gas-url').value;
            spreadsheetName = document.getElementById('spreadsheet-name').value;
            
            // Simpan ke localStorage
            localStorage.setItem('syncTime', syncTime);
            localStorage.setItem('autoSync', autoSync);
            localStorage.setItem('manualOverride', manualOverride);
            localStorage.setItem('gasUrl', gasUrl);
            localStorage.setItem('spreadsheetName', spreadsheetName);
            
            // Update UI
            initSyncTime();
            showGlobalMessage('Pengaturan berhasil disimpan!', 'success');
        }

        // Get time ago string
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) {
                return 'Baru saja';
            } else if (diffMins < 60) {
                return `${diffMins} menit yang lalu`;
            } else if (diffHours < 24) {
                return `${diffHours} jam yang lalu`;
            } else {
                return `${diffDays} hari yang lalu`;
            }
        }

        // Open import progress modal
        function openImportProgressModal() {
            document.getElementById('import-progress-modal').classList.remove('hidden');
        }

        // Close import progress modal
        function closeImportProgressModal() {
            document.getElementById('import-progress-modal').classList.add('hidden');
        }

        // Update import progress
        function updateImportProgress(percentage, message) {
            const progressBar = document.getElementById('progress-bar');
            const progressPercentage = document.getElementById('progress-percentage');
            const progressStatus = document.getElementById('progress-status');
            
            if (progressBar) {
                progressBar.style.width = `${percentage}%`;
                progressPercentage.textContent = `${percentage}%`;
                progressStatus.textContent = message;
            }
        }

        // Handle import submit (modified for pending system)
        async function handleImportSubmit(event) {
            event.preventDefault();
            
            if (parsedImportData.length === 0) {
                showGlobalMessage('Tidak ada data valid untuk diimport.', 'error');
                return;
            }
            
            const submitButton = document.getElementById('import-submit-button');
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...';
            
            // Tampilkan progress modal
            openImportProgressModal();
            updateImportProgress(25, 'Mempersiapkan data...');
            
            try {
                // Simpan ke Google Sheets (Pending Import)
                updateImportProgress(50, 'Menyimpan ke Google Sheets...');
                
                const result = await saveToPendingImport(parsedImportData);
                
                if (!result.success) {
                    throw new Error(result.message);
                }
                
                updateImportProgress(100, 'Data berhasil disimpan!');
                
                // Tunggu sebentar untuk menunjukkan progress 100%
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                closeImportProgressModal();
                closeImportModal();
                
                showGlobalMessage(
                    `Berhasil menyimpan ${parsedImportData.length} data ke pending import. Data akan disinkronisasi ke Supabase jam ${syncTime}.`,
                    'success'
                );
                
                // Refresh pending imports count
                checkPendingImports();
                
            } catch (error) {
                console.error("Import Error:", error);
                closeImportProgressModal();
                showGlobalMessage(`Gagal menyimpan ke pending import: ${error.message}`, 'error');
            } finally {
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>Simpan ke Pending Import';
            }
        }

        // Switch view dengan tambahan pending-import
        function switchView(viewId) {
            // Hide all views
            document.querySelectorAll('[id$="-view"]').forEach(view => {
                view.classList.add('hidden');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Update breadcrumb
            const viewTitles = {
                'dashboard': 'Dashboard',
                'karyawan': 'Data Karyawan',
                'absensi': 'Log Absensi',
                'pending-import': 'Pending Import',
                'laporan': 'Laporan',
                'pengaturan': 'Pengaturan'
            };
            
            document.getElementById('breadcrumb-current').textContent = 
                viewTitles[viewId] || 'Dashboard';
            
            // Show selected view
            document.getElementById(`${viewId}-view`).classList.remove('hidden');
            
            // Add active class to selected nav item
            const navItem = document.querySelector(`.nav-item[onclick*="${viewId}"]`);
            if (navItem) navItem.classList.add('active');
            
            // Load data for view
            switch(viewId) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'karyawan':
                    loadKaryawan();
                    break;
                case 'absensi':
                    loadAbsensi();
                    break;
                case 'pending-import':
                    loadPendingImport();
                    break;
                case 'laporan':
                    loadLaporan();
                    break;
                case 'pengaturan':
                    // Settings view doesn't need data loading
                    break;
            }
            
            currentView = viewId;
            
            // Close mobile menu if open
            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth < 768 && sidebar.classList.contains('show')) {
                sidebar.classList.remove('show');
            }
        }

        // Load pending import view
        async function loadPendingImport() {
            await checkPendingImports();
            
            // Update database status
            try {
                const { data, error } = await supabaseClient
                    .from(TABLE_NAME)
                    .select('card')
                    .limit(1);
                
                if (error) throw error;
                document.getElementById('db-status').textContent = 'Online';
            } catch (error) {
                document.getElementById('db-status').textContent = 'Offline';
                document.getElementById('db-status').classList.add('text-red-600', 'dark:text-red-400');
            }
        }

        // Initialize the rest of the functions from previous code
        // (All other functions remain the same as in the previous implementation)
        // ... [Previous functions remain unchanged]

        // Note: Due to character limit, I've focused on implementing the pending import system.
        // The rest of the functions (toggleSidebar, toggleTheme, fetchData, etc.) 
        // should be copied from the previous implementation.

    </script>
</body>
</html>
